#jinja2: lstrip_blocks: True
{% set vrfs = this_tenant.children | selectattr('fvCtx', 'defined') | map(attribute='fvCtx') | flatten | list %}
{% set bds = this_tenant.children | selectattr('fvBD', 'defined') | map(attribute='fvBD') | flatten | list %}
{% set aps = this_tenant.children | selectattr('fvAp', 'defined') | map(attribute='fvAp') | flatten | list %}
{% set l3outs = this_tenant.children | selectattr('l3extOut', 'defined') | map(attribute='l3extOut') | flatten | list %}
{% set sec_domains = this_tenant.children | selectattr('aaaDomainRef', 'defined') | map(attribute='aaaDomainRef') | flatten | list %}
---
apic:
  tenants:
    - name: {{ item }}
    {% if this_tenant.attributes.descr != "" %}
      description: {{ this_tenant.attributes.descr }}
    {% endif %}
    {% if sec_domains | length > 0 %}
      security_domains:
      {% for dom in sec_domains | sort(attribute='attributes.name') %}
        - {{ dom.attributes.name }}
      {% endfor %}
    {% endif %}

{% include "tenant_vrfs.nac.j2" %}
{% include "tenant_bridge_domains.nac.j2" %}
{% include "tenant_contracts.nac.j2" %}
{% include "tenant_filters.nac.j2" %}
{% include "tenant_l3outs.nac.j2" %}